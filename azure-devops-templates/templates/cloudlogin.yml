steps:
  - task: CmdLine@2
    displayName: aws login
    inputs:
      script: |
        set -e
        aws configure set aws_access_key_id $(AWS_ACCESS_KEY_ID_${{ parameters.env }})
        aws configure set aws_secret_access_key $(AWS_SECRET_ACCESS_KEY_${{ parameters.env }})
        aws configure set default.region $(AWS_REGION_${{ parameters.env }})
        subs_id=$(aws sts get-caller-identity --query 'Account' --output text)
        region=$(AWS_REGION_${{ parameters.env }})
        echo "##vso[task.setvariable variable=env]${{ parameters.env }}"
        echo "##vso[task.setvariable variable=subs_id]$subs_id"
        echo "##vso[task.setvariable variable=region]$region"
        aws s3 ls > /dev/null
        echo "##[section]Authenticated successfully in ${{ parameters.env }}"
      workingDirectory: "$(Build.Repository.LocalPath)/$(apppath)"